<!DOCTYPE HTML>
<html>
	<head>
		<title>To Do List</title>
		<style>
			.container {
				background-color: #878787;
				min-height: 600px;
				margin: 0 auto;
				width: 800px;
			}
			.todo-container {
				width: 450px;
				margin: 0 auto;
			}
			.row {
				display: flex;
				position: relative;
				cursor: pointer;
			}
			.close {
				position: absolute;
				right: 0;
				top: 9px;
			}
			.row:hover .close::after {
				content: 'x';
				background: dimgray;
				padding: 5px;
				width: 10px;
				border-radius: 11%;
				line-height: 24px;
				font-family: sans-serif;
			}
			.input {
				width: 300px;
				padding: 10px;
				border: none;
				border-radius: 30px;
				margin-bottom: 16px;
				font-size: 22px;
				font-family: cursive;
				margin-right: 10px;
				margin-top: 10px;
			}
			.input:disabled {
				background: cadetblue;
				color: white;
			}
			.display {
				color: #fff;
			}
			li {
				font-size: 22px;
				font-family: cursive;
				list-style: none;
				padding-left: 14px;
				margin-bottom: 10px;
			}
			.checkbox {
				cursor: pointer;
				position: relative;

				
			}
			.control {
				visibility: hidden;
				position: absolute;
				top: 0;
				left: 0;
			}

			.control:checked + .control-indicator {
				background-color: white;
				border: 1.4px solid white;
				border-radius: 1.5px;
				cursor: pointer;
					
				}
				.control:checked + .control-indicator::before {
					position: absolute;
					content: '';
					left: 7px;
					top: 3px;
					width: 5px;
					height: 13px;
					border: solid green;
					border-width: 0 3px 3px 0;
					transform: rotate(45deg);
					backface-visibility: hidden;
						display: block;
					}
			

			.control-indicator {
				position: relative;
				width: 25px;
				height: 25px;
				background-color: #eee;
				border: 1.4px solid black;
				border-radius: 1.5px;
				box-sizing: border-box;
				display: inline-block;
				vertical-align: middle;
				cursor: pointer;

			}
			.input-wrap {
				display: flex;
			}
			#clear {
				cursor: pointer;
				font-size: 22px;
				margin-top: 24px;
				color: #fff;
				margin-left: 13px;
			}
			.strike {
				text-decoration: line-through;
			}
			
		</style>
	</head>
	<body onload='displayTodos()'>
		<div class='container'>
			<div class='todo-container'>
				<div class='input-wrap'>
						<input  type='text' class='input' placeholder='Add a todo...' onChange='addTodo(event)'/> 
						<span id='clear'> Clear List</span>
				</div>
				<div class='display'></div>
			</div>

		<script>
			const todos = JSON.parse(localStorage.getItem('myTodos')) || [];
			let count = 0;
	
			function addTodo (todo) {
				todo.target && todos.push({text: todo.target.value, index: count}); // if you add todo it will push, otherwise just displays todos from storage
				const displayNode = document.querySelector('.display');
				const newTodo = document.createElement('div');
				newTodo.className = 'row'
				displayNode.appendChild(newTodo);

				const checkBox = document.createElement('input');
				checkBox.type = 'checkbox';
				checkBox.className = 'control';
				const spanNode = document.createElement('div');
				spanNode.className = 'control-indicator'
				const labelNode = document.createElement('label');
				labelNode.className = 'checkbox'

				checkBox.addEventListener('change', changeTodo.bind(this, count));

				labelNode.appendChild(checkBox);
				labelNode.appendChild(spanNode);
				newTodo.appendChild(labelNode);

				const todoNode = document.createElement('li');
				if (todo.target) {
					todoNode.innerText = todo.target.value || todo.text;
					todo.target.value = '';
				} else {
					todoNode.innerText = todo.text;
					checkBox.checked = todo.done;
				}
				
				if (todo.done) {
					todoNode.classList.add('strike');
				}
				newTodo.appendChild(todoNode);

				const closeNode = document.createElement('span');
				closeNode.className = 'close'
				closeNode.addEventListener('click', deleteTodo.bind(this, count));
				newTodo.appendChild(closeNode);

				todo.target && localStorage.setItem('myTodos', JSON.stringify(todos));
				console.log('add or display', todos, JSON.parse(localStorage.getItem('myTodos')));
				count++;
			}

			function changeTodo(changeIndex, e) {
				todos[changeIndex].done = !todos[changeIndex].done;
				console.log('change todos', todos, e);
				localStorage.setItem('myTodos', JSON.stringify(todos));
				e.target.parentElement.nextSibling.classList.toggle('strike');

			}

			function displayTodos () {
				const displayItems = JSON.parse(localStorage.getItem('myTodos'));
				displayItems && displayItems.map((item) => {
					addTodo(item);
				})
			}

			function deleteTodo(deleteIndex, e) {
				todos.splice(deleteIndex, 1);
				console.log('delete', todos);
				localStorage.setItem('myTodos', JSON.stringify(todos));
				e.target.parentElement.style.display = 'none';
			}

			document.getElementById('clear').onclick = function () {
				localStorage.clear();
				window.location.reload();
			}
		</script>
	</body>
</html>