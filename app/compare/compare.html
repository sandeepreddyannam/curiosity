<!DOCTYPE html>
<html>
	<head>
		<title>Compare widget</title> 
		<style>
			body {
				font-family: Arial;
				margin: 10px;
			}
			div {
				margin-bottom: 10px;
			}
			img {
				width: 200px;
				margin-bottom: 10px;
			}
			.container {
				display: flex;
			}
			.summary-container {
				/* flex: 1; */
			}
			.image-container {
				display: flex;
				
			}
			.img-cont {
				margin: 10px;
				position: relative;
			}
			.delete {
				position: absolute;
				top: 0;
				right: 26px;
				border: solid 1px #f0f0f0;
				padding: 10px;
				border-radius: 50%;
				font-size: 12px;
				cursor: pointer;
				box-shadow: 1px 3px 5px 0px rgba(0, 0, 0, 0.2);
			}
			.summary{
				display: flex;
				border-bottom: solid 1px #f0f0f0;
			}
			
			.each-feature {
				display: flex;
			}
			.add-product {
				flex: 1;
				text-align: center;
				padding-top: 20%;
				border: solid 1px #f0f0f0;
				border-top: none;
				border-bottom: none;
			}
			
		</style>
	</head>
	<body>
		<div class='container'>
			
			<div class='summary-container'>
				<div class='image-container'>
					<h2 class='compare-heading'>
						Compare Products
					</h2>
				</div>
				<div class='summary'>
				</div>
				<div class='feature-container'>
				</div>
			</div>
			<div class='add-product' onClick='addProduct(event)'>
				Add product
			</div>

			
		</div>
		<!-- <script type='module' src='https://unpkg.com/htm?module'></script> -->

		<script>
			// Fetching api;
			var compareRes = {
products: {
featuresList: [
{
features: [
{
featureName: "Size",
values: {
TVSF2WYXTKAR7RAF: "108 cm (43)",
TVSF2WYUE4PWNJKM: "80 cm (32)",
TVSE8FMZ9AQMEGC6: "102 cm (40)",
TVSF3J7HUJF5XUBT: "138.71 cm (55)"
}
},
{
featureName: "Screen Type",
values: {
TVSF2WYXTKAR7RAF: "LED",
TVSF2WYUE4PWNJKM: "LED",
TVSE8FMZ9AQMEGC6: "QLED",
TVSF3J7HUJF5XUBT: "LED"
}
},
{
featureName: "HD Technology & Resolution",
values: {
TVSF2WYXTKAR7RAF: "Full HD, 1920 x 1080 Pixels",
TVSF2WYUE4PWNJKM: "HD Ready, 1366 x 768 Pixels",
TVSE8FMZ9AQMEGC6: "Full HD, 1920 x 1080",
TVSF3J7HUJF5XUBT: "Ultra HD (4K), 3840 x 2160 Pixels"
}
},
{
featureName: "3D",
properties: {
isDifferent: false
},
values: {
TVSF2WYXTKAR7RAF: "No",
TVSF2WYUE4PWNJKM: "No",
TVSE8FMZ9AQMEGC6: "No",
TVSF3J7HUJF5XUBT: "No"
}
}
],
title: "Display"
},
{
features: [
{
featureName: "Smart TV",
values: {
TVSF2WYXTKAR7RAF: "Yes",
TVSF2WYUE4PWNJKM: "Yes",
TVSE8FMZ9AQMEGC6: "Yes",
TVSF3J7HUJF5XUBT: "Yes"
}
},
{
featureName: "Curve TV",
values: {
TVSF2WYXTKAR7RAF: "Yes",
TVSF2WYUE4PWNJKM: "No",
TVSE8FMZ9AQMEGC6: "No",
TVSF3J7HUJF5XUBT: "No"
}
},
{
featureName: "Touchscreen",
values: {
TVSF2WYXTKAR7RAF: "Yes",
TVSF2WYUE4PWNJKM: "No",
TVSE8FMZ9AQMEGC6: "No",
TVSF3J7HUJF5XUBT: "No"
}
},
{
featureName: "Motion Sensor",
values: {
TVSF2WYXTKAR7RAF: "No",
TVSF2WYUE4PWNJKM: "No",
TVSE8FMZ9AQMEGC6: "No",
TVSF3J7HUJF5XUBT: "No"
}
},
{
featureName: "Launch Year",
values: {
TVSF2WYXTKAR7RAF: "2018",
TVSF2WYUE4PWNJKM: "2018",
TVSE8FMZ9AQMEGC6: "2015",
TVSF3J7HUJF5XUBT: "2018"
}
}
],
title: "General Features"
},
{
features: [
{
featureName: "Built In Wi-Fi",
properties: {
isDifferent: true
},
values: {
TVSF2WYXTKAR7RAF: "Yes",
TVSF2WYUE4PWNJKM: "Yes",
TVSE8FMZ9AQMEGC6: "Yes",
TVSF3J7HUJF5XUBT: "Yes"
}
},
{
featureName: "3G Dongle Plug and Play",
properties: {
isDifferent: false
},
values: {
TVSF2WYXTKAR7RAF: "No",
TVSF2WYUE4PWNJKM: "No",
TVSE8FMZ9AQMEGC6: "No",
TVSF3J7HUJF5XUBT: "No"
}
},
{
featureName: "Ethernet (RJ45)",
properties: {
isDifferent: true
},
values: {
TVSF2WYXTKAR7RAF: "1",
TVSF2WYUE4PWNJKM: "1",
TVSE8FMZ9AQMEGC6: "0",
TVSF3J7HUJF5XUBT: "1"
}
},
{
featureName: "Wireless Ready",
properties: {
isDifferent: true
},
values: {
TVSF2WYXTKAR7RAF: "Yes",
TVSF2WYUE4PWNJKM: "Yes",
TVSE8FMZ9AQMEGC6: "Yes",
TVSF3J7HUJF5XUBT: "Yes"
}
}
],
title: "Internet Features"
}
],
compareSummary: {
images: {
TVSF2WYXTKAR7RAF: "https://rukminim1.flixcart.com/image/1000/1000/jefzonk0/television/r/a/f/mi-l43m5-ai-original-imaf34hgjzc4xr62.jpeg?q=100",
TVSF2WYUE4PWNJKM: "https://rukminim1.flixcart.com/image/1000/1000/jefzonk0/television/j/k/m/mi-l32m5-ai-original-imaf34hfqb2fekxx.jpeg?q=100",
TVSE8FMZ9AQMEGC6: "https://rukminim1.flixcart.com/image/1000/1000/jj367bk0/television/g/c/6/vu-40d6575-original-imaf6qqy4vfneabe.jpeg?q=100",
TVSF3J7HUJF5XUBT: "https://rukminim1.flixcart.com/image/1000/1000/jgffp8w0/television/u/b/t/iffalcon-55k2a-original-imaf4z2mn6xrxk5f.jpeg?q=100"
},
titles: {
TVSF2WYXTKAR7RAF: {
subtitle: null,
title: "Mi LED Smart TV 4A 108 cm (43)"
},
TVSF2WYUE4PWNJKM: {
subtitle: null,
title: "Mi LED Smart TV 4A 80 cm (32)"
},
TVSE8FMZ9AQMEGC6: {
subtitle: "40D6575",
title: "Vu 102cm (40 inch) Full HD LED TV"
},
TVSF3J7HUJF5XUBT: {
subtitle: "55K2A",
title: "iFFALCON K2A 138.71cm (55 inch) Ultra HD (4K) LED Smart TV"
}
},
productPricingSummary: {
TVSF2WYXTKAR7RAF: {
finalPrice: "22999.00",
price: "25999.00",
totalDiscount: 11
},
TVSF2WYUE4PWNJKM: {
finalPrice: "13999.00",
price: "15999.00",
totalDiscount: 14
},
TVSE8FMZ9AQMEGC6: {
finalPrice: "16999.00",
price: "11999.00",
totalDiscount: 11
},
TVSF3J7HUJF5XUBT: {
finalPrice: "26999.00",
price: "23999.00",
totalDiscount: 13
}
}
}
}
}
			
			var allPids = [];

			renderProducts();

			// function fetchCompareJson() {
			// 	const url = 'https://flipkart-mock-product.now.sh/';
			// 	fetch(url).then(res=>{
			// 		return res.json()
			// 	}).then(json => {
			// 		compareRes = json;
			// 		console.log(compareRes);

			// 		// formatResponse(json);
			// 		// may be pass it to func.
			// 		renderProducts();
			// 	}).catch(err => console.log(err));
			// }

			// function formatResponse (res) {
			// 	//extract pids
			// 	const pids = Object.keys(res.products.compareSummary.images);
			// 	allPids = pids;

			// 	// console.log(pids);
			// 	// exract summary;
			// 	const images = res.products.compareSummary.images;
			// 	const titles = res.products.compareSummary.titles;
			// 	const productPricingSummary = res.products.compareSummary.productPricingSummary;
			// 	const featuresList = res.products.featuresList;
			// 	const formattedRes = {};
			// 	pids.map(pid => {
			// 		formattedRes[pid] = {
			// 			image: images[pid],
			// 			summary: {
			// 				...productPricingSummary[pid],
			// 			titles: titles[pid]
			// 			}
			// 		};
			// 	});
			// 	featuresList.map(item => {
			// 		item.features.map(eachItem => {
			// 			Object.keys(eachItem.values).map(pid => {
			// 				const featuresObj = {
			// 					features: {
			// 						[eachItem.featureName]: eachItem.values[pid]
			// 					}
			// 				}
			// 				formattedRes[pid] = Object.assign({}, formattedRes[pid], {features: {...formattedRes[pid].features, ...featuresObj.features}});
						
			// 			})
			// 			// eachItem.values[]
			// 		})
			// 	})
			// 	console.log(formattedRes);
			// 	compareRes = formattedRes;
			// 	// renderPrfixes(formattedRes);
			// 	renderSummary(formattedRes);
			// }

			function deletItem(id) {
				console.log('id', id);
				const imageEl = document.querySelector('.image-container');
				const titlesEl = document.querySelector('.summary');
				const featureCont = document.querySelector('.feature-container');

				const removeImg = imageEl.querySelector(`[data-${id.toLowerCase()}]`);
				const removeTitle = titlesEl.querySelector(`[data-${id.toLowerCase()}]`);

				imageEl.removeChild(removeImg);
				titlesEl.removeChild(removeTitle);

				const deleteArr = featureCont.querySelectorAll('.each-feature');
				deleteArr.forEach(eachNode => {
					const removFeatureEl = eachNode.querySelector(`[data-${id.toLowerCase()}]`);
					console.log(removFeatureEl);
					eachNode.removeChild(removFeatureEl);
				})

			}

			function addProduct(event) {
				console.log('e', event);
				const addEl = document.querySelector('.add-product');
				addEl.style.display = 'none';

				const pid = ['TVSF3J7HUJF5XUBT'];

				var images = compareRes.products.compareSummary.images;
				var priceSummary = compareRes.products.compareSummary.productPricingSummary;
				var titles = compareRes.products.compareSummary.titles;

				renderImages(images, '33', pid);
				renderTitles(titles, '33', pid, false);

				const features = compareRes.products.featuresList;

				renderFeatures(features, '33', pid, true);

			}

			function renderProducts() {
				console.log('compareRes', compareRes);

				var images = compareRes.products.compareSummary.images;
				var priceSummary = compareRes.products.compareSummary.productPricingSummary;
				var titles = compareRes.products.compareSummary.titles;

				const totalPids = Object.keys(compareRes.products.compareSummary.images);
				const renderPids = totalPids.slice(0, 2); // use this for modificaiton

				const width = Math.floor(100 / (renderPids.length + 1));

				console.log('totalPids', totalPids, renderPids);
				console.log('images', images, titles);

				const compareHeading = document.querySelector('.compare-heading');
				compareHeading.style.width = width + '%';

				const summaryContainer = document.querySelector('.summary-container');
				summaryContainer.style.flex = renderPids.length + 1;

				renderImages(images, width, renderPids);
				renderTitles(titles, width, renderPids, true);
				// render Price

				const features = compareRes.products.featuresList;

				renderFeatures(features, width, renderPids);
			}

			function renderImages(imageItems, width, renderPids) {
				var imageEl = document.querySelector('.image-container');
				renderPids.map(item => {
					let src = imageItems[item];
					let divEl = document.createElement('div');
					let imgEl = document.createElement('img');
					imgEl.setAttribute('src', src);
					divEl.className = 'img-cont';
					divEl.style.width = width + '%';
					divEl.setAttribute(`data-${item}`, item);

					// add delete button
					const deleteEl = document.createElement('div');
					deleteEl.textContent = 'X';
					deleteEl.className = 'delete';
					deleteEl.addEventListener('click', () => {
						deletItem(item);
					})


					divEl.appendChild(imgEl);
					divEl.appendChild(deleteEl);
					imageEl.appendChild(divEl);
				})
			}

			function generateId (header) {
				if (!header) {
					return '';
				}
				return header.toLowerCase().replace(/\s/g, '_')
			}

			function renderTitles(titles, width, renderPids, addEmptySpace) {
				var titlesEl = document.querySelector('.summary');
				addEmptySpace && renderEmptySpace(width);

				renderPids.map(item => {
					const titleValues = titles[item];
					const divEl = document.createElement('div');
					const titleElement = document.createElement('div');
					const subTitleEl = document.createElement('div');

					titleElement.textContent = titleValues.title;
					subTitleEl.textContent = titleValues.subtitle;

					divEl.style.width = width + '%';
					divEl.setAttribute(`data-${item}`, item);

					divEl.appendChild(titleElement);
					divEl.appendChild(subTitleEl);
					titlesEl.appendChild(divEl);
				})
			}

			function renderFeatures(features, width, renderPids, appendToRow) {
				const featureCont = document.querySelector('.feature-container');
				features.map(item => {
					if(!appendToRow) {
						const headingEl = document.createElement('h2');
						headingEl.textContent = item.title;
						featureCont.appendChild(headingEl);
					}
				
					item.features.map(eachFeature => {
						renderEachSection(eachFeature, width, renderPids, appendToRow);
					});
				});

			}

			function renderEachSection(feature, width, renderPids, appendToRow) {

				if (appendToRow) {
					const parentId = document.getElementById(generateId(feature.featureName));
					renderPids.map(key => {
						const featureDiv = document.createElement('div');
						featureDiv.textContent = feature.values[key];
						featureDiv.style.width =  width + '%';
						featureDiv.setAttribute(`data-${key}`, key);
						parentId.appendChild(featureDiv);
					});
					
				} else {
					const featureCont = document.querySelector('.feature-container');
					const container = document.createElement('div');
					container.className = 'each-feature';
					container.setAttribute('id', generateId(feature.featureName));
					
					const prefixEl = document.createElement('div');
					prefixEl.textContent = feature.featureName;
					prefixEl.style.width = width + '%';
					container.appendChild(prefixEl);
					
					renderPids.map(key => {
						const featureDiv = document.createElement('div');
						featureDiv.textContent = feature.values[key];
						featureDiv.style.width =  width + '%';
						featureDiv.setAttribute(`data-${key}`, key);
						container.appendChild(featureDiv);
					});
					featureCont.appendChild(container);
				}
			}

			function renderEmptySpace (width) {
				var titlesEl = document.querySelector('.summary');
				var emptyDiv = document.createElement('div');
				emptyDiv.style.width = width + '%';
				titlesEl.appendChild(emptyDiv);
			}


		</script>
	</body>
</html>